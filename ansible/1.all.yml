- hosts: all
  tasks:
    - name: install ntp
      shell: yum install -y ntp
    - name: ntp time
      shell: ntpdate ntp1.aliyun.com
    - name: edit hostname  # 修改所有节点hostname
      template: 
        src: ~/k8s-ansible/template/hostname.j2
        dest: /etc/hostname
    - name: copy hosts to /etc/hosts #修改所有节点hosts
      copy: 
        src: ~/k8s-ansible/customer/hosts
        dest: /etc/hosts
    - name: mkdir conf dir /opt/kubernetes/conf #所有节点创建k8s配置文件目录
      file:
        path=/opt/kubernetes/conf
        state=directory
    - name: mkdir conf dir /opt/kubernetes/ssl #所有节点创建k8s ssl目录
      file:
        path=/opt/kubernetes/ssl
        state=directory
    - name: mkdir conf dir /opt/kubernetes/logs #所有节点创建k8s logs目录
      file:
        path=/opt/kubernetes/logs
        state=directory
    - name: disable all nodes firewalld.service  #所有节点禁用防火墙
      shell: systemctl disable firewalld.service
    - name: stop all nodes firewalld.service  #  所有节点关闭防火墙
      shell: systemctl stop firewalld.service
